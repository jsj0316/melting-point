
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë¡œë¥´ì‚°ê³¼ íŒ”ë¯¸íŠ¸ì‚°ì˜ ë…¹ëŠ”ì  ë¹„êµí•˜ê¸°</title>
<link href="https://fonts.googleapis.com/css2?family=Gaegu:wght@400;700&family=Jua&family=Cute+Font&family=Do+Hyeon&family=Black+Han+Sans&display=swap" rel="stylesheet">
<style>
:root {
  --blue:   #1458a8;
  --blue2:  #4a8fd4;
  --amber:  #b56000;
  --amber2: #d4943a;
  --green:  #1b6e1f;
  --red:    #b71c1c;
  --border: #d8d8d8;
  --bg:     #ffffff;
  --panel:  #f8f9fa;
  --text:   #111111;
  --dim:    #333333;
  --muted:  #666666;
  --shadow: 0 1px 8px rgba(0,0,0,0.10);
  --font:   'Gaegu', cursive;
  --title:  'Jua', sans-serif;
  --mono:   'Do Hyeon', sans-serif;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:#fff;color:var(--text);font-family:var(--font);min-height:100vh;display:flex;flex-direction:column;}

/* â”€â”€ Header â”€â”€ */
header{
  background:#fff;border-bottom:2px solid var(--border);
  padding:14px 28px;display:flex;align-items:center;gap:12px;
  position:sticky;top:0;z-index:100;box-shadow:var(--shadow);
}
.hbadge{background:#111;color:#fff;font-family:var(--title);font-size:0.8rem;padding:4px 10px;border-radius:6px;letter-spacing:1px;flex-shrink:0;}
header h1{font-size:1.15rem;font-weight:700;letter-spacing:0px;line-height:1.3;font-family:var(--title);color:#111;}
header h1 span{font-size:0.8rem;font-weight:400;color:#555;display:block;margin-top:2px;font-family:var(--font);}

/* â”€â”€ Layout â”€â”€ */
.wrap{flex:1;display:grid;grid-template-columns:240px 1fr;gap:18px;max-width:1320px;width:100%;margin:0 auto;padding:18px;}

/* â”€â”€ Control panel â”€â”€ */
.ctrl{
  background:var(--panel);border:1.5px solid var(--border);border-radius:14px;
  padding:18px;display:flex;flex-direction:column;gap:18px;
  height:fit-content;position:sticky;top:76px;
}
.clabel{font-size:0.75rem;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:#333;margin-bottom:7px;border-bottom:2px solid var(--border);padding-bottom:4px;font-family:var(--title);}

/* Substance selector */
.sub-cards{display:flex;flex-direction:column;gap:8px;}
.sub-card{
  border:2px solid var(--border);border-radius:10px;padding:10px 13px;cursor:pointer;
  transition:all .18s;background:#fff;position:relative;overflow:hidden;
}
.sub-card::before{content:'';position:absolute;left:0;top:0;bottom:0;width:4px;}
.sub-card.blue::before{background:var(--blue);}
.sub-card.amber::before{background:var(--amber);}
.sub-card.blue.on{border-color:var(--blue);background:rgba(26,111,196,0.05);}
.sub-card.amber.on{border-color:var(--amber);background:rgba(196,122,26,0.05);}
.sub-name{font-size:1rem;font-weight:700;margin-bottom:2px;font-family:var(--title);}
.sub-card.blue .sub-name{color:#0d47a1;}
.sub-card.amber .sub-name{color:#8d4200;}
.sub-form{font-family:var(--mono);font-size:0.72rem;color:#444;}
.sub-chk{position:absolute;right:10px;top:50%;transform:translateY(-50%);width:18px;height:18px;border-radius:50%;border:2px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:10px;transition:all .18s;}
.sub-card.blue.on .sub-chk{background:var(--blue);border-color:var(--blue);color:#fff;}
.sub-card.amber.on .sub-chk{background:var(--amber);border-color:var(--amber);color:#fff;}

/* Amount */
.amts{display:grid;grid-template-columns:1fr 1fr;gap:7px;}
.amt-btn{
  background:#fff;border:2px solid var(--border);border-radius:9px;
  padding:9px 6px;text-align:center;cursor:pointer;
  font-family:var(--title);font-size:1rem;font-weight:700;color:#222;transition:all .18s;
}
.amt-btn:hover{border-color:#555;}
.amt-btn.on{border-color:var(--green);background:rgba(27,110,31,0.08);color:#1b6e1f;}

/* Speed */
.speed-row{display:flex;align-items:center;gap:8px;}
input[type=range]{flex:1;height:3px;appearance:none;background:var(--border);border-radius:2px;outline:none;}
input[type=range]::-webkit-slider-thumb{appearance:none;width:15px;height:15px;border-radius:50%;background:var(--text);cursor:pointer;border:2px solid #fff;box-shadow:0 1px 4px rgba(0,0,0,.2);}
.spv{font-family:var(--title);font-size:0.85rem;color:#111;min-width:28px;text-align:right;font-weight:700;}

/* Buttons */
.btn{padding:11px;border:none;border-radius:9px;font-family:var(--title);font-size:0.95rem;font-weight:700;cursor:pointer;transition:all .18s;width:100%;}
.btn-go{background:var(--text);color:#fff;}
.btn-go:hover{background:#333;transform:translateY(-1px);}
.btn-go:disabled{opacity:.3;cursor:not-allowed;transform:none;}
.btn-stop{background:var(--red);color:#fff;display:none;}
.btn-rst{background:#fff;border:1.5px solid var(--border);color:var(--dim);}
.btn-rst:hover{border-color:var(--red);color:var(--red);}
.btn-clr{background:#fff;border:1.5px solid var(--border);color:var(--muted);font-size:0.8rem;}
.btn-clr:hover{border-color:var(--dim);color:var(--dim);}

/* Progress */
.prog-lbl{font-size:0.7rem;color:var(--muted);margin-bottom:4px;height:15px;}
.prog-wrap{background:var(--border);border-radius:3px;height:5px;overflow:hidden;}
.prog-fill{height:100%;border-radius:3px;background:linear-gradient(90deg,var(--blue),var(--amber));width:0%;transition:width .2s;}

/* Hint */
.hint-btn{background:none;border:2px dashed #bbb;border-radius:8px;padding:8px 11px;color:#444;font-size:0.85rem;cursor:pointer;font-family:var(--title);transition:all .18s;width:100%;text-align:left;}
.hint-btn:hover{border-color:#555;color:#111;}
.hint-box{background:rgba(27,110,31,0.05);border:1.5px solid var(--green);border-radius:8px;padding:12px 14px;font-size:0.88rem;line-height:1.8;color:#222;display:none;margin-top:7px;font-family:var(--font);}
.hint-box.on{display:block;}

/* Click-to-mark instructions */
.mark-tip{background:#fff8e1;border:1.5px solid #ffc107;border-radius:8px;padding:9px 12px;font-size:0.85rem;color:#5a3e00;line-height:1.6;display:none;font-family:var(--font);}
.mark-tip.on{display:block;}

/* â”€â”€ Right â”€â”€ */
.right{display:flex;flex-direction:column;gap:16px;}

/* Beaker panel */
.beaker-panel{background:var(--panel);border:1.5px solid var(--border);border-radius:14px;padding:20px;}
.ptitle{font-size:0.95rem;font-weight:700;letter-spacing:0px;color:#111;margin-bottom:16px;display:flex;align-items:center;gap:8px;flex-wrap:wrap;font-family:var(--title);}
.beaker-row{display:grid;grid-template-columns:1fr 1fr;gap:20px;}
.beaker-unit{display:flex;flex-direction:column;align-items:center;gap:8px;}
.bname{font-size:0.88rem;font-weight:700;font-family:var(--title);}
.bname.bl{color:#0d47a1;} .bname.ba{color:#7a3400;}
.thermo{border:2.5px solid #bbb;border-radius:7px;padding:5px 12px;font-family:var(--mono);font-size:1.1rem;font-weight:700;text-align:center;min-width:88px;background:#fff;color:#111;}
.thermo.tl{color:#0d47a1;border-color:#0d47a1;}
.thermo.tp{color:#7a3400;border-color:#c47a1a;}
.schip{font-size:0.82rem;font-weight:700;padding:4px 13px;border-radius:20px;border:2px solid;letter-spacing:.2px;font-family:var(--title);}
.sc-s{background:#eeeeee;color:#333;border-color:#bbb;}
.sc-m{background:rgba(27,110,31,0.13);color:#1b5e20;border-color:#388e3c;animation:blink .9s ease-in-out infinite;}
.sc-l{background:rgba(122,52,0,0.10);color:#7a3400;border-color:#c47a1a;}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.5}}

/* â”€â”€ Graphs â”€â”€ */
.graphs-row{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
.graph-box{background:#fff;border:1.5px solid var(--border);border-radius:14px;padding:20px;}
.graph-header{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:4px;gap:8px;flex-wrap:wrap;}
.graph-title{font-size:1rem;font-weight:700;font-family:var(--title);}
.graph-title.gl{color:#0d47a1;} .graph-title.ga{color:#7a3400;}
.graph-legend{display:flex;flex-direction:column;gap:4px;font-size:0.78rem;color:#333;font-family:var(--font);}
.leg{display:flex;align-items:center;gap:5px;}
.leg-line{width:20px;height:2.5px;border-radius:2px;flex-shrink:0;}
canvas.gcv{width:100%;display:block;cursor:crosshair;border-radius:4px;border:1.5px solid var(--border);margin-top:8px;}

/* Marked points list */
.marks-list{margin-top:8px;max-height:80px;overflow-y:auto;display:flex;flex-wrap:wrap;gap:4px;}
.mark-tag{
  font-family:var(--title);font-size:0.75rem;padding:3px 9px;border-radius:6px;
  background:#f0f0f0;border:1.5px solid #ccc;color:#111;
  display:flex;align-items:center;gap:4px;cursor:default;font-weight:700;
}
.mark-tag .del{cursor:pointer;color:var(--muted);font-size:10px;line-height:1;}
.mark-tag .del:hover{color:var(--red);}

/* â”€â”€ Summary â”€â”€ */
.summary{background:var(--panel);border:1.5px solid var(--border);border-radius:14px;padding:20px;display:none;}
.summary.on{display:block;}
.sum-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:12px 0;}
.sum-card{border-radius:10px;padding:14px 16px;}
.sum-card.sl{background:rgba(13,71,161,0.06);border:2px solid #0d47a1;}
.sum-card.sa{background:rgba(122,52,0,0.06);border:2px solid #c47a1a;}
.sum-mp{font-family:var(--title);font-size:1.8rem;font-weight:700;margin:3px 0 2px;}
.sum-card.sl .sum-mp{color:#0d47a1;} .sum-card.sa .sum-mp{color:#7a3400;}
.sum-sub{font-size:0.82rem;color:#333;font-family:var(--font);}
.insight{background:rgba(27,110,31,0.06);border:2px solid #388e3c;border-radius:10px;padding:14px 16px;font-size:0.9rem;line-height:1.9;color:#111;font-family:var(--font);}
.insight strong{color:#1b5e20;}

/* â”€â”€ Quiz â”€â”€ */
.quiz{background:var(--panel);border:1.5px solid var(--border);border-radius:14px;padding:20px;display:none;}
.quiz.on{display:block;}
.q-item{background:#fff;border:1.5px solid var(--border);border-radius:10px;padding:14px 16px;margin-bottom:10px;}
.q-text{font-size:0.95rem;font-weight:700;margin-bottom:10px;line-height:1.7;color:#111;font-family:var(--title);}
.q-opts{display:flex;flex-direction:column;gap:6px;}
.q-opt{background:var(--panel);border:2px solid var(--border);border-radius:7px;padding:9px 13px;cursor:pointer;font-family:var(--font);font-size:0.9rem;color:#111;text-align:left;transition:all .15s;font-weight:700;}
.q-opt:hover:not(:disabled){border-color:#555;background:#f5f5f5;}
.q-opt.correct{border-color:#388e3c;background:rgba(56,142,60,0.09);color:#1b5e20;}
.q-opt.wrong{border-color:#b71c1c;background:rgba(183,28,28,0.07);color:#b71c1c;}
.q-fb{font-size:0.88rem;margin-top:8px;padding:10px 13px;border-radius:7px;display:none;line-height:1.7;font-family:var(--font);font-weight:700;}
.q-fb.on{display:block;}
.q-fb.ok{background:rgba(56,142,60,0.08);color:#1b5e20;border:1.5px solid #388e3c;}
.q-fb.no{background:rgba(183,28,28,0.07);color:#b71c1c;border:1.5px solid #b71c1c;}

footer{margin-top:20px;border-top:1.5px solid var(--border);padding:12px 28px;display:flex;align-items:center;justify-content:space-between;font-size:0.8rem;color:#444;background:var(--panel);flex-wrap:wrap;gap:6px;font-family:var(--font);}
footer strong{color:#111;}

@media(max-width:900px){
  .wrap{grid-template-columns:1fr;}
  .ctrl{position:static;}
  .graphs-row{grid-template-columns:1fr;}
}
@media(max-width:560px){
  .beaker-row{grid-template-columns:1fr;}
  .sum-grid{grid-template-columns:1fr;}
}
</style>
</head>
<body>

<header>
  <div class="hbadge">ğŸ”¬ LAB</div>
  <div>
    <h1>ë¡œë¥´ì‚°ê³¼ íŒ”ë¯¸íŠ¸ì‚°ì˜ ë…¹ëŠ”ì  ë¹„êµí•˜ê¸°
      <span>ë¬¼ì§ˆì˜ íŠ¹ì„± Â· ë…¹ëŠ”ì ê³¼ ìƒíƒœ ë³€í™” íƒêµ¬</span>
    </h1>
  </div>
</header>

<div class="wrap">

  <!-- â”€â”€ ì œì–´íŒ â”€â”€ -->
  <aside class="ctrl">

    <div>
      <div class="clabel">âš—ï¸ ë¬¼ì§ˆ ì„ íƒ</div>
      <div class="sub-cards">
        <div class="sub-card blue on" onclick="toggleSub('L',this)">
          <div class="sub-name">ë¡œë¥´ì‚°</div>
          <div class="sub-form">Câ‚â‚‚Hâ‚‚â‚„Oâ‚‚ Â· ë…¹ëŠ”ì  44Â°C</div>
          <div class="sub-chk">âœ“</div>
        </div>
        <div class="sub-card amber on" onclick="toggleSub('P',this)">
          <div class="sub-name">íŒ”ë¯¸íŠ¸ì‚°</div>
          <div class="sub-form">Câ‚â‚†Hâ‚ƒâ‚‚Oâ‚‚ Â· ë…¹ëŠ”ì  63Â°C</div>
          <div class="sub-chk">âœ“</div>
        </div>
      </div>
      <div style="font-size:0.7rem;color:var(--muted);margin-top:7px;line-height:1.5;">
        ì²´í¬í•œ ë¬¼ì§ˆë§Œ ì‹¤í—˜í•©ë‹ˆë‹¤.<br>ê° ê·¸ë˜í”„ì— 1gÂ·2g ê³¡ì„ ì´ í•¨ê»˜ í‘œì‹œë©ë‹ˆë‹¤.
      </div>
    </div>

    <div>
      <div class="clabel">âš–ï¸ ì‹¤í—˜ ì§ˆëŸ‰</div>
      <div class="amts">
        <button class="amt-btn on" onclick="setAmt(1,this)">1 g</button>
        <button class="amt-btn on" onclick="setAmt(2,this)" id="amt2btn">2 g</button>
      </div>
      <div style="font-size:0.7rem;color:var(--muted);margin-top:7px;line-height:1.5;">
        ë‘ ì§ˆëŸ‰ ëª¨ë‘ ì„ íƒí•˜ë©´ ê° ê·¸ë˜í”„ì—ì„œ 1gÂ·2g ê³¡ì„ ì„ ë¹„êµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </div>
    </div>

    <div>
      <div class="clabel">âš¡ ê°€ì—´ ì†ë„</div>
      <div class="speed-row">
        <span style="font-size:0.7rem;color:var(--muted)">ëŠë¦¼</span>
        <input type="range" id="spdSlider" min="1" max="5" value="2" oninput="setSpd(this.value)">
        <span style="font-size:0.7rem;color:var(--muted)">ë¹ ë¦„</span>
        <span class="spv" id="spdVal">2Ã—</span>
      </div>
    </div>

    <div style="display:flex;flex-direction:column;gap:7px;">
      <button class="btn btn-go"  id="btnGo"   onclick="startExp()">â–¶ ê°€ì—´ ì‹œì‘</button>
      <button class="btn btn-stop" id="btnStop" onclick="stopExp()">â¸ ì¼ì‹œ ì •ì§€</button>
      <button class="btn btn-clr" onclick="clearMarks()">ğŸ—‘ ì°ì€ ì  ëª¨ë‘ ì§€ìš°ê¸°</button>
      <button class="btn btn-rst" onclick="resetAll()">â†º ì „ì²´ ì´ˆê¸°í™”</button>
    </div>

    <div>
      <div class="prog-lbl" id="progLbl"></div>
      <div class="prog-wrap"><div class="prog-fill" id="progFill"></div></div>
    </div>

    <div>
      <button class="hint-btn" onclick="toggleHint()">ğŸ’¡ íŒíŠ¸ / í•µì‹¬ ê°œë…</button>
      <div class="hint-box" id="hintBox">
        <strong>ë…¹ëŠ”ì ì´ë€?</strong><br>
        ìˆœë¬¼ì§ˆì´ ê³ ì²´ â†’ ì•¡ì²´ë¡œ ë³€í•˜ëŠ” ì˜¨ë„.<br>
        ê°€ì—´ ê³¡ì„ ì—ì„œ <strong>ì˜¨ë„ê°€ ì¼ì •í•œ êµ¬ê°„</strong>ì´ ë…¹ëŠ”ì !<br><br>
        <strong>ì–‘ê³¼ ë…¹ëŠ”ì ì˜ ê´€ê³„?</strong><br>
        1gê³¼ 2gì˜ <em>ë…¹ëŠ”ì (ì˜¨ë„)ì€ ê°™ê³ </em>,<br>
        ë…¹ëŠ” ë° ê±¸ë¦¬ëŠ” <em>ì‹œê°„ë§Œ ë‹¬ë¼ì§‘ë‹ˆë‹¤</em>.
      </div>
    </div>

    <div>
      <div class="mark-tip on" id="markTip">
        ğŸ“ <strong>ê·¸ë˜í”„ ìœ„ë¥¼ í´ë¦­</strong>í•˜ë©´ í•´ë‹¹ ì§€ì ì˜ ì˜¨ë„Â·ì‹œê°„ ê°’ì´ ì ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤. ë…¹ëŠ”ì  êµ¬ê°„ì„ ì§ì ‘ ì°¾ì•„ë³´ì„¸ìš”!
      </div>
    </div>

  </aside>

  <!-- â”€â”€ ì‹¤í—˜ ì˜ì—­ â”€â”€ -->
  <div class="right">

    <!-- ë¹„ì»¤ -->
    <div class="beaker-panel">
      <div class="ptitle">ğŸ§ª ì‹¤í—˜ ì¥ì¹˜ â€” í˜„ì¬ ìƒíƒœ</div>
      <div class="beaker-row" id="beakerRow">
        <!-- injected -->
      </div>
    </div>

    <!-- ê·¸ë˜í”„ 2ê°œ -->
    <div class="graphs-row">
      <!-- ë¡œë¥´ì‚° ê·¸ë˜í”„ -->
      <div class="graph-box" id="boxL">
        <div class="graph-header">
          <div>
            <div class="graph-title gl">ë¡œë¥´ì‚° ê°€ì—´ ê³¡ì„ </div>
            <div style="font-size:0.7rem;color:var(--muted);margin-top:2px;">ë…¹ëŠ”ì : 44Â°C</div>
          </div>
          <div class="graph-legend">
            <div class="leg"><div class="leg-line" style="background:var(--blue)"></div>1 g</div>
            <div class="leg"><div class="leg-line" style="background:var(--blue2);border-top:2px dashed var(--blue2);height:0;"></div>2 g</div>
            <div class="leg"><div style="width:20px;height:0;border-top:2px dashed #f59e0b;"></div>ë…¹ëŠ”ì </div>
          </div>
        </div>
        <canvas class="gcv" id="gL" height="220"></canvas>
        <div class="marks-list" id="marksL"></div>
      </div>

      <!-- íŒ”ë¯¸íŠ¸ì‚° ê·¸ë˜í”„ -->
      <div class="graph-box" id="boxP">
        <div class="graph-header">
          <div>
            <div class="graph-title ga">íŒ”ë¯¸íŠ¸ì‚° ê°€ì—´ ê³¡ì„ </div>
            <div style="font-size:0.7rem;color:var(--muted);margin-top:2px;">ë…¹ëŠ”ì : 63Â°C</div>
          </div>
          <div class="graph-legend">
            <div class="leg"><div class="leg-line" style="background:var(--amber)"></div>1 g</div>
            <div class="leg"><div class="leg-line" style="background:var(--amber2);border-top:2px dashed var(--amber2);height:0;"></div>2 g</div>
            <div class="leg"><div style="width:20px;height:0;border-top:2px dashed #f59e0b;"></div>ë…¹ëŠ”ì </div>
          </div>
        </div>
        <canvas class="gcv" id="gP" height="220"></canvas>
        <div class="marks-list" id="marksP"></div>
      </div>
    </div>

    <!-- ê²°ê³¼ ìš”ì•½ -->
    <div class="summary" id="sumPanel">
      <div class="ptitle">âœ… ì‹¤í—˜ ê²°ê³¼ ìš”ì•½</div>
      <div class="sum-grid">
        <div class="sum-card sl">
          <div class="sum-sub">ë¡œë¥´ì‚°</div>
          <div class="sum-mp">44Â°C</div>
          <div class="sum-sub">ë…¹ëŠ”ì  Â· Câ‚â‚‚Hâ‚‚â‚„Oâ‚‚</div>
        </div>
        <div class="sum-card sa">
          <div class="sum-sub">íŒ”ë¯¸íŠ¸ì‚°</div>
          <div class="sum-mp">63Â°C</div>
          <div class="sum-sub">ë…¹ëŠ”ì  Â· Câ‚â‚†Hâ‚ƒâ‚‚Oâ‚‚</div>
        </div>
      </div>
      <div class="insight" id="insightBox"></div>
    </div>

    <!-- í™•ì¸ ë¬¸ì œ -->
    <div class="quiz" id="quizPanel">
      <div class="ptitle">ğŸ§ª í™•ì¸ ë¬¸ì œ</div>
      <div id="quizBox"></div>
    </div>

  </div>
</div>

<footer>
  <div>ğŸ”¬ <strong>ë¡œë¥´ì‚°ê³¼ íŒ”ë¯¸íŠ¸ì‚°ì˜ ë…¹ëŠ”ì  ë¹„êµí•˜ê¸°</strong> Â· ê°€ìƒ ì‹¤í—˜ì‹¤</div>
  <div>ì œì‘ì: <strong>ê³¼í•™ì²´ìœ¡ê´€ &amp; ì†¡ìŒ¤ê³¼í•™</strong> &nbsp;|&nbsp; Last updated: <strong id="footerDate"></strong> &nbsp;|&nbsp; All rights reserved Â©</div>
</footer>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SIM_DUR = 140;
const T_START = 25, TMAX = 80, TMIN = 20;

const SUB = {
  L: { name:'ë¡œë¥´ì‚°',   mp:44, c1:'#1a6fc4', c2:'#5ba4e8', cmp:'#1a6fc4' },
  P: { name:'íŒ”ë¯¸íŠ¸ì‚°', mp:63, c1:'#c47a1a', c2:'#e8b45b', cmp:'#c47a1a' }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let activeSubs = { L: true, P: true };
let amtOn = { 1: true, 2: true };
let speedMult = 2, paused = false, running = false, simT = 0, intId = null;

// data[key] = [{t, temp}]   key = 'L1', 'L2', 'P1', 'P2'
let data = { L1:[], L2:[], P1:[], P2:[] };

// user-marked points  marks[canvasId] = [{t, temp, label}]
let marks = { L:[], P:[] };
let markCount = { L:0, P:0 };

// canvas refs
const CV = {}, CTX = {};
const PAD = {l:50, r:20, t:16, b:34};
let CW = {L:0, P:0}, CH = 220;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.onload = () => {
  ['L','P'].forEach(k => {
    CV[k]  = document.getElementById('g'+k);
    CTX[k] = CV[k].getContext('2d');
    CV[k].addEventListener('click', e => onGraphClick(e, k));
  });
  window.addEventListener('resize', () => { resizeAll(); drawAll(); });
  resizeAll();
  buildBeakers();
  drawAll();
  document.getElementById('footerDate').textContent =
    new Date().toLocaleDateString('ko-KR',{year:'numeric',month:'long',day:'numeric'});
};

function resizeAll() {
  ['L','P'].forEach(k => {
    const w = CV[k].parentElement.getBoundingClientRect().width - 40;
    CW[k] = Math.max(w, 200);
    CV[k].width  = CW[k] * devicePixelRatio;
    CV[k].height = CH   * devicePixelRatio;
    CV[k].style.width  = CW[k] + 'px';
    CV[k].style.height = CH    + 'px';
    CTX[k].setTransform(1,0,0,1,0,0);
    CTX[k].scale(devicePixelRatio, devicePixelRatio);
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SIMULATION MODEL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function tempAt(key, amt, t) {
  const mp   = SUB[key].mp;
  const rate = amt === 1 ? 0.46 : 0.28;
  const solidDur = (mp - T_START) / rate;
  const meltDur  = amt === 1 ? 10 : 17;
  if (t <= solidDur)              return T_START + rate * t;
  if (t <= solidDur + meltDur)   return mp;
  return mp + rate * 0.82 * (t - solidDur - meltDur);
}

function stateAt(key, amt, t) {
  const mp   = SUB[key].mp;
  const rate = amt === 1 ? 0.46 : 0.28;
  const solid = (mp - T_START) / rate;
  const melt  = amt === 1 ? 10 : 17;
  if (t < solid - 0.2) return 'solid';
  if (t < solid + melt) return 'melting';
  return 'liquid';
}

function liqFrac(key, amt, t) {
  const rate  = amt === 1 ? 0.46 : 0.28;
  const solid = (SUB[key].mp - T_START) / rate;
  const melt  = amt === 1 ? 10 : 17;
  if (t <= solid) return 0;
  if (t >= solid + melt) return 1;
  return (t - solid) / melt;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CONTROLS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleSub(k, el) {
  // must keep at least one
  const other = k === 'L' ? 'P' : 'L';
  if (activeSubs[k] && !activeSubs[other]) return; // can't deselect last
  activeSubs[k] = !activeSubs[k];
  el.classList.toggle('on', activeSubs[k]);
  el.querySelector('.sub-chk').textContent = activeSubs[k] ? 'âœ“' : '';
  buildBeakers();
  drawAll();
}

function setAmt(a, btn) {
  const other = a === 1 ? 2 : 1;
  // toggle
  amtOn[a] = !amtOn[a];
  // must keep at least one
  if (!amtOn[1] && !amtOn[2]) { amtOn[a] = true; }
  document.querySelectorAll('.amt-btn').forEach((b,i) => b.classList.toggle('on', amtOn[i===0?1:2]));
  drawAll();
}

function setSpd(v) {
  speedMult = +v;
  document.getElementById('spdVal').textContent = v + 'Ã—';
}

function toggleHint() {
  document.getElementById('hintBox').classList.toggle('on');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  EXPERIMENT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startExp() {
  if (paused) { resume(); return; }
  clearInterval(intId);
  simT = 0; data = {L1:[],L2:[],P1:[],P2:[]}; running = true; paused = false;
  document.getElementById('btnGo').style.display  = 'none';
  document.getElementById('btnStop').style.display = 'block';
  document.getElementById('sumPanel').classList.remove('on');
  document.getElementById('quizPanel').classList.remove('on');
  resetBeakerFill();
  doTick();
}

function stopExp() {
  if (!running) return;
  paused = true; clearInterval(intId);
  document.getElementById('btnGo').textContent   = 'â–¶ ê³„ì†í•˜ê¸°';
  document.getElementById('btnGo').style.display  = 'block';
  document.getElementById('btnStop').style.display = 'none';
}

function resume() {
  paused = false;
  document.getElementById('btnGo').style.display  = 'none';
  document.getElementById('btnStop').style.display = 'block';
  doTick();
}

function doTick() {
  const step = 0.2;
  const ms   = Math.round(40 / speedMult);
  intId = setInterval(() => {
    simT += step;
    ['L','P'].forEach(k => {
      [1,2].forEach(a => {
        const t_ = tempAt(k, a, simT);
        data[k+a].push({t: simT, temp: +t_.toFixed(1)});
      });
    });

    updateBeakers();
    drawAll();

    const pct = Math.min(simT / SIM_DUR * 100, 100);
    document.getElementById('progFill').style.width = pct + '%';
    document.getElementById('progLbl').textContent  = 'ì§„í–‰: ' + Math.round(pct) + '%';

    if (simT >= SIM_DUR) {
      clearInterval(intId); running = false;
      document.getElementById('btnStop').style.display = 'none';
      document.getElementById('btnGo').textContent     = 'â–¶ ê°€ì—´ ì‹œì‘';
      document.getElementById('btnGo').style.display   = 'block';
      document.getElementById('progLbl').textContent   = 'ì‹¤í—˜ ì™„ë£Œ âœ“';
      showSummary(); showQuiz();
    }
  }, ms);
}

function resetAll() {
  clearInterval(intId); running=false; paused=false; simT=0;
  data = {L1:[],L2:[],P1:[],P2:[]};
  marks = {L:[],P:[]}; markCount = {L:0,P:0};
  document.getElementById('btnGo').textContent  = 'â–¶ ê°€ì—´ ì‹œì‘';
  document.getElementById('btnGo').style.display = 'block';
  document.getElementById('btnStop').style.display = 'none';
  document.getElementById('progFill').style.width = '0%';
  document.getElementById('progLbl').textContent = '';
  document.getElementById('sumPanel').classList.remove('on');
  document.getElementById('quizPanel').classList.remove('on');
  document.getElementById('marksL').innerHTML = '';
  document.getElementById('marksP').innerHTML = '';
  resetBeakerFill();
  drawAll();
}

function clearMarks() {
  marks = {L:[],P:[]}; markCount = {L:0,P:0};
  document.getElementById('marksL').innerHTML = '';
  document.getElementById('marksP').innerHTML = '';
  drawAll();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CLICK-TO-MARK ON GRAPH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function onGraphClick(e, k) {
  const cv = CV[k];
  const rect = cv.getBoundingClientRect();
  const px = e.clientX - rect.left;
  const py = e.clientY - rect.top;
  const W  = CW[k];

  // Convert pixel to data coords
  const tVal   = ((px - PAD.l) / (W - PAD.l - PAD.r)) * SIM_DUR;
  const tempVal = TMIN + (1 - (py - PAD.t) / (CH - PAD.t - PAD.b)) * (TMAX - TMIN);

  if (tVal < 0 || tVal > SIM_DUR || tempVal < TMIN || tempVal > TMAX) return;

  // snap to nearest data point on any active curve
  let bestDist = Infinity, snappedT = tVal, snappedTemp = tempVal, snappedAmt = 1;
  ['L','P'].forEach(sk => {
    if (!activeSubs[sk] || sk !== k) return;
    [1,2].forEach(a => {
      if (!amtOn[a]) return;
      const d = data[sk+a];
      if (!d.length) return;
      d.forEach(pt => {
        const dx = (pt.t/SIM_DUR)*(W-PAD.l-PAD.r) + PAD.l - px;
        const dy = (1-(pt.temp-TMIN)/(TMAX-TMIN))*(CH-PAD.t-PAD.b) + PAD.t - py;
        const dist = Math.sqrt(dx*dx+dy*dy);
        if (dist < bestDist) { bestDist=dist; snappedT=pt.t; snappedTemp=pt.temp; snappedAmt=a; }
      });
    });
  });

  // only snap if within 20px; otherwise mark raw position
  if (bestDist > 20) return;

  markCount[k]++;
  const label = 'P' + markCount[k];
  marks[k].push({ t: snappedT, temp: snappedTemp, amt: snappedAmt, label });
  addMarkTag(k, label, snappedT, snappedTemp);
  drawAll();
}

function addMarkTag(k, label, t, temp) {
  const container = document.getElementById('marks'+k);
  const tag = document.createElement('div');
  tag.className = 'mark-tag';
  tag.id = 'tag_'+k+'_'+label;
  tag.innerHTML = `<span style="color:${k==='L'?'var(--blue)':'var(--amber)'};font-weight:700">${label}</span>&nbsp;t=${t.toFixed(0)}s &nbsp;${temp.toFixed(1)}Â°C <span class="del" onclick="removeMark('${k}','${label}')">âœ•</span>`;
  container.appendChild(tag);
}

function removeMark(k, label) {
  marks[k] = marks[k].filter(m => m.label !== label);
  const tag = document.getElementById('tag_'+k+'_'+label);
  if (tag) tag.remove();
  drawAll();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  BEAKERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const BX=16, BY=12, BW=76, BH=86;

function buildBeakers() {
  const row = document.getElementById('beakerRow');
  row.innerHTML = '';
  ['L','P'].forEach(k => {
    if (!activeSubs[k]) return;
    const s = SUB[k];
    row.innerHTML += `
    <div class="beaker-unit">
      <div class="bname ${k==='L'?'bl':'ba'}">${s.name} (C${k==='L'?'â‚â‚‚Hâ‚‚â‚„':'â‚â‚†Hâ‚ƒâ‚‚'}Oâ‚‚)</div>
      <div id="bsvg${k}">${makeSVG(k, s.c1)}</div>
      <div class="thermo ${k==='L'?'tl':'tp'}" id="thermo${k}">25.0 Â°C</div>
      <div class="schip sc-s" id="chip${k}">ê³ ì²´ ğŸ§Š</div>
    </div>`;
  });
}

function makeSVG(k, stroke) {
  const W=112, H=145;
  const solidFill  = k==='L' ? '#c8dff5' : '#f5ddb8';  // ê³ ì²´: ë°ì€ ë¶ˆíˆ¬ëª… ìƒ‰
  const liquidFill = k==='L' ? '#5ba4e888' : '#d4943a88'; // ì•¡ì²´: ë°˜íˆ¬ëª…
  const surfFill   = k==='L' ? '#4a8fd4cc' : '#c47a1acc'; // ê²½ê³„ì„ 
  return `<svg width="${W}" height="${H}" viewBox="0 0 ${W} ${H}" xmlns="http://www.w3.org/2000/svg" style="display:block;">
    <defs>
      <clipPath id="bc${k}"><rect x="${BX}" y="${BY}" width="${BW}" height="${BH}" rx="2"/></clipPath>
    </defs>
    <text x="${W/2}" y="${H-1}" text-anchor="middle" font-size="21">ğŸ”¥</text>
    <!-- ë¹„ì»¤ ë°°ê²½ -->
    <rect x="${BX}" y="${BY}" width="${BW}" height="${BH}" fill="#f7f4ee" rx="2"/>
    <!-- ì•¡ì²´ì¸µ (ì•„ë˜ì—ì„œ ìœ„ë¡œ ì°¨ì˜¤ë¦„) -->
    <rect id="bliq${k}" x="${BX}" y="${BY+BH}" width="${BW}" height="0"
          fill="${liquidFill}" clip-path="url(#bc${k})"/>
    <!-- ê³ ì²´ ë¸”ë¡ (ìœ„ì—ì„œ ì•„ë˜ë¡œ ì¤„ì–´ë“¦ â€” ì‹¤ì œë¡œëŠ” yê³ ì •, height ê°ì†Œ) -->
    <rect id="bsol${k}" x="${BX}" y="${BY}" width="${BW}" height="${BH}"
          fill="${solidFill}" clip-path="url(#bc${k})"/>
    <!-- ê³ ì²´-ì•¡ì²´ ê²½ê³„ ì–‡ì€ ì„  -->
    <rect id="bsrf${k}" x="${BX}" y="${BY+BH}" width="${BW}" height="2"
          fill="${surfFill}" opacity="0" clip-path="url(#bc${k})"/>
    <!-- ëˆˆê¸ˆ -->
    <line x1="${BX}" y1="${BY+21}" x2="${BX+8}" y2="${BY+21}" stroke="#ccc" stroke-width="1"/>
    <line x1="${BX}" y1="${BY+43}" x2="${BX+8}" y2="${BY+43}" stroke="#ccc" stroke-width="1"/>
    <line x1="${BX}" y1="${BY+65}" x2="${BX+8}" y2="${BY+65}" stroke="#ccc" stroke-width="1"/>
    <!-- ë¹„ì»¤ ì™¸ê³½ì„  -->
    <path d="M${BX} ${BY} L${BX} ${BY+BH+5} Q${BX} ${BY+BH+12} ${BX+10} ${BY+BH+12} L${BX+BW-10} ${BY+BH+12} Q${BX+BW} ${BY+BH+12} ${BX+BW} ${BY+BH+5} L${BX+BW} ${BY} Z"
          fill="none" stroke="${stroke}" stroke-width="2.5" stroke-linejoin="round"/>
    <line x1="${BX-6}" y1="${BY}" x2="${BX+BW+6}" y2="${BY}" stroke="${stroke}" stroke-width="2.5" stroke-linecap="round"/>
    <!-- ì˜¨ë„ê³„ -->
    <rect x="${BX+BW-17}" y="${BY+4}" width="7" height="50" rx="3.5" fill="#f0f0f0" stroke="${stroke}" stroke-width="1.2"/>
    <circle cx="${BX+BW-13.5}" cy="${BY+58}" r="6.5" fill="${stroke}"/>
    <rect id="bmerc${k}" x="${BX+BW-15}" y="${BY+26}" width="3.5" height="28" fill="${stroke}" rx="1.75"/>
  </svg>`;
}

function updateBeakers() {
  ['L','P'].forEach(k => {
    if (!activeSubs[k]) return;
    // use 1g data as primary display
    const d = data[k+'1'];
    if (!d.length) return;
    const last = d[d.length-1];
    const temp  = last.temp;
    const state = stateAt(k, 1, simT);
    const frac  = liqFrac(k, 1, simT);

    const th = document.getElementById('thermo'+k);
    const ch = document.getElementById('chip'+k);
    if (th) th.textContent = temp.toFixed(1) + ' Â°C';
    if (ch) {
      ch.className = 'schip';
      if (state==='solid')   { ch.classList.add('sc-s'); ch.textContent='ê³ ì²´ ğŸ§Š'; }
      if (state==='melting') { ch.classList.add('sc-m'); ch.textContent='ë…¹ëŠ” ì¤‘ âœ¨'; }
      if (state==='liquid')  { ch.classList.add('sc-l'); ch.textContent='ì•¡ì²´ ğŸ’§'; }
    }

    const lh = frac * BH;   // ì•¡ì²´ ë†’ì´
    const sh = (1 - frac) * BH; // ê³ ì²´ ë†’ì´
    const liqEl = document.getElementById('bliq'+k);
    const solEl = document.getElementById('bsol'+k);
    const srfEl = document.getElementById('bsrf'+k);
    const merEl = document.getElementById('bmerc'+k);
    if (!liqEl) return;

    // ì•¡ì²´: ë¹„ì»¤ ë°”ë‹¥ë¶€í„° ìœ„ë¡œ ì°¨ì˜¤ë¦„
    liqEl.setAttribute('y', BY + BH - lh);
    liqEl.setAttribute('height', lh);

    // ê³ ì²´: ìœ„ì—ì„œ ì‹œì‘í•´ì„œ ì•„ë˜ìª½ ê²½ê³„ê°€ ì¤„ì–´ë“¦ (ìœ„ì¹˜ ê³ ì •, heightë§Œ ê°ì†Œ)
    solEl.setAttribute('y', BY);
    solEl.setAttribute('height', sh);

    // ê²½ê³„ì„ : ê³ ì²´ ì•„ë˜ìª½ì— í‘œì‹œ
    srfEl.setAttribute('y', BY + sh - 1);
    srfEl.setAttribute('opacity', frac > 0.02 && frac < 0.98 ? 1 : 0);

    // ì˜¨ë„ê³„ ìˆ˜ì€ ìƒìŠ¹
    const rise = Math.min(((temp - 25) / 55) * 26, 26);
    merEl.setAttribute('y', BY + 54 - rise);
    merEl.setAttribute('height', 28 + rise);
  });
}

function resetBeakerFill() {
  ['L','P'].forEach(k => {
    const liq=document.getElementById('bliq'+k), sol=document.getElementById('bsol'+k),
          srf=document.getElementById('bsrf'+k),
          mer=document.getElementById('bmerc'+k), th=document.getElementById('thermo'+k),
          ch=document.getElementById('chip'+k);
    if(!liq)return;
    liq.setAttribute('y', BY+BH); liq.setAttribute('height', 0);
    sol.setAttribute('y', BY);    sol.setAttribute('height', BH);
    srf.setAttribute('opacity', 0);
    mer.setAttribute('y', BY+26); mer.setAttribute('height', 28);
    if(th) th.textContent='25.0 Â°C';
    if(ch) { ch.className='schip sc-s'; ch.textContent='ê³ ì²´ ğŸ§Š'; }
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  GRAPH DRAWING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function drawAll() {
  ['L','P'].forEach(k => drawGraph(k));
}

function xOf(k, t)    { return PAD.l + (t / SIM_DUR) * (CW[k] - PAD.l - PAD.r); }
function yOf(temp)    { return PAD.t + (1 - (temp - TMIN) / (TMAX - TMIN)) * (CH - PAD.t - PAD.b); }
function tFromX(k,px) { return ((px - PAD.l) / (CW[k] - PAD.l - PAD.r)) * SIM_DUR; }

function drawGraph(k) {
  if (!CV[k]) return;
  const ctx_ = CTX[k];
  const W    = CW[k];
  const s    = SUB[k];

  ctx_.clearRect(0, 0, W, CH);
  ctx_.fillStyle = '#ffffff';
  ctx_.fillRect(0, 0, W, CH);

  // grid
  ctx_.strokeStyle = '#e8e8e8'; ctx_.lineWidth = 1;
  for (let T = TMIN; T <= TMAX; T += 10) {
    const y = yOf(T);
    ctx_.beginPath(); ctx_.moveTo(PAD.l, y); ctx_.lineTo(W - PAD.r, y); ctx_.stroke();
    ctx_.fillStyle = '#222'; ctx_.font = 'bold 11px "Do Hyeon", sans-serif';
    ctx_.fillText(T + 'Â°', PAD.l - 32, y + 4);
  }
  for (let t = 0; t <= SIM_DUR; t += 20) {
    const x = xOf(k, t);
    ctx_.beginPath(); ctx_.moveTo(x, PAD.t); ctx_.lineTo(x, CH - PAD.b); ctx_.stroke();
    ctx_.fillStyle = '#222'; ctx_.font = 'bold 10px "Do Hyeon", sans-serif';
    ctx_.fillText(t, x - 6, CH - PAD.b + 14);
  }

  // axis labels
  ctx_.fillStyle = '#111'; ctx_.font = 'bold 12px "Jua", sans-serif';
  ctx_.fillText('ì‹œê°„ (ì´ˆ)', W / 2 - 22, CH - 4);
  ctx_.save(); ctx_.translate(12, CH / 2 + 22); ctx_.rotate(-Math.PI / 2);
  ctx_.fillText('ì˜¨ë„ (Â°C)', 0, 0); ctx_.restore();

  // melting point line
  const mpy = yOf(s.mp);
  ctx_.setLineDash([5,4]); ctx_.strokeStyle = '#f59e0b'; ctx_.lineWidth = 1.5;
  ctx_.beginPath(); ctx_.moveTo(PAD.l, mpy); ctx_.lineTo(W - PAD.r, mpy); ctx_.stroke();
  ctx_.setLineDash([]);
  ctx_.fillStyle = '#e67e00'; ctx_.font = 'bold 11px "Do Hyeon", sans-serif';
  ctx_.fillText(s.mp + 'Â°C', W - PAD.r - 34, mpy - 5);

  // curves â€” 1g solid, 2g dashed
  [[1, s.c1, []], [2, s.c2, [5,4]]].forEach(([amt, color, dash]) => {
    if (!amtOn[amt]) return;
    const d = data[k + amt];
    if (d.length < 2) return;

    // fill
    ctx_.beginPath();
    ctx_.moveTo(xOf(k, d[0].t), yOf(d[0].temp));
    for (let i = 1; i < d.length; i++) ctx_.lineTo(xOf(k, d[i].t), yOf(d[i].temp));
    ctx_.lineTo(xOf(k, d[d.length-1].t), yOf(TMIN));
    ctx_.lineTo(xOf(k, d[0].t), yOf(TMIN));
    ctx_.closePath();
    ctx_.fillStyle = color + '18';
    ctx_.fill();

    // line
    ctx_.setLineDash(dash);
    ctx_.beginPath();
    ctx_.moveTo(xOf(k, d[0].t), yOf(d[0].temp));
    for (let i = 1; i < d.length; i++) ctx_.lineTo(xOf(k, d[i].t), yOf(d[i].temp));
    ctx_.strokeStyle = color; ctx_.lineWidth = 2.2; ctx_.lineJoin = 'round'; ctx_.stroke();
    ctx_.setLineDash([]);

    // current endpoint
    const last = d[d.length - 1];
    ctx_.beginPath();
    ctx_.arc(xOf(k, last.t), yOf(last.temp), 4.5, 0, Math.PI * 2);
    ctx_.fillStyle = color; ctx_.fill();
    ctx_.strokeStyle = '#fff'; ctx_.lineWidth = 1.5; ctx_.stroke();
  });

  // â”€â”€ Draw user-marked points â”€â”€
  marks[k].forEach((m, idx) => {
    const x = xOf(k, m.t);
    const y = yOf(m.temp);
    const color = m.amt === 1 ? s.c1 : s.c2;

    // outer ring
    ctx_.beginPath();
    ctx_.arc(x, y, 9, 0, Math.PI * 2);
    ctx_.fillStyle = color + '22'; ctx_.fill();
    ctx_.strokeStyle = color; ctx_.lineWidth = 2; ctx_.stroke();

    // dot
    ctx_.beginPath();
    ctx_.arc(x, y, 4.5, 0, Math.PI * 2);
    ctx_.fillStyle = color; ctx_.fill();

    // label bubble
    const label = m.label;
    ctx_.font = 'bold 11px "Jua", sans-serif';
    const tw = ctx_.measureText(label).width;
    const bx = x + 10, by = y - 16;
    const bw = tw + 10, bh = 17;

    ctx_.fillStyle = '#fff';
    ctx_.strokeStyle = color;
    ctx_.lineWidth = 1.5;
    roundRect(ctx_, bx, by - bh + 2, bw, bh, 5);
    ctx_.fill(); ctx_.stroke();

    ctx_.fillStyle = color;
    ctx_.fillText(label, bx + 5, by - 2);

    ctx_.font = 'bold 10px "Do Hyeon", sans-serif';
    ctx_.fillStyle = '#111';
    ctx_.fillText(m.temp.toFixed(1) + 'Â°C', x - 18, y + 22);
  });
}

function roundRect(ctx_, x, y, w, h, r) {
  ctx_.beginPath();
  ctx_.moveTo(x + r, y);
  ctx_.lineTo(x + w - r, y);
  ctx_.quadraticCurveTo(x + w, y, x + w, y + r);
  ctx_.lineTo(x + w, y + h - r);
  ctx_.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
  ctx_.lineTo(x + r, y + h);
  ctx_.quadraticCurveTo(x, y + h, x, y + h - r);
  ctx_.lineTo(x, y + r);
  ctx_.quadraticCurveTo(x, y, x + r, y);
  ctx_.closePath();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SUMMARY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showSummary() {
  document.getElementById('sumPanel').classList.add('on');
  const amtText = (amtOn[1] && amtOn[2]) ? '1gê³¼ 2g' : amtOn[1] ? '1g' : '2g';
  document.getElementById('insightBox').innerHTML = `
    <strong>ğŸ” ë‘ ë¬¼ì§ˆì˜ ë…¹ëŠ”ì  ë¹„êµ</strong><br>
    ë¡œë¥´ì‚°ì˜ ë…¹ëŠ”ì  <strong>44Â°C</strong>ì™€ íŒ”ë¯¸íŠ¸ì‚°ì˜ ë…¹ëŠ”ì  <strong>63Â°C</strong>ëŠ” ì„œë¡œ ë‹¤ë¦…ë‹ˆë‹¤.<br>
    ë…¹ëŠ”ì ì€ ë¬¼ì§ˆë§ˆë‹¤ ê³ ìœ í•œ <em>ë¬¼ì§ˆì˜ íŠ¹ì„±</em>ì´ë¯€ë¡œ ë‘ ë¬¼ì§ˆì„ <strong>êµ¬ë³„í•˜ëŠ” ê¸°ì¤€</strong>ì´ ë©ë‹ˆë‹¤.<br><br>
    <strong>âš–ï¸ ì–‘(ì§ˆëŸ‰)ê³¼ ë…¹ëŠ”ì  â€” ${amtText} ë¹„êµ</strong><br>
    ê° ê·¸ë˜í”„ì—ì„œ 1g(ì‹¤ì„ )ê³¼ 2g(ì ì„ )ì˜ ê³¡ì„ ì„ ë³´ë©´, <strong>ë…¹ëŠ”ì (ì˜¨ë„)ì€ ë™ì¼</strong>í•˜ê³ <br>
    2gì´ ë” ì˜¤ëœ ì‹œê°„ ë…¹ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë…¹ëŠ”ì ì€ <strong>ì–‘ê³¼ ë¬´ê´€í•œ íŠ¹ì„±</strong>ì…ë‹ˆë‹¤.
  `;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  QUIZ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const QS = [
  { q:'ë¡œë¥´ì‚°ê³¼ íŒ”ë¯¸íŠ¸ì‚°ì„ ë…¹ëŠ”ì ìœ¼ë¡œ êµ¬ë³„í•  ìˆ˜ ìˆëŠ” ì´ìœ ëŠ”?',
    opts:['ì–‘ì´ ì„œë¡œ ë‹¤ë¥´ê¸° ë•Œë¬¸','ë…¹ëŠ”ì ì€ ë¬¼ì§ˆì˜ ì¢…ë¥˜ë§ˆë‹¤ ê³ ìœ í•œ íŠ¹ì„±ì´ê¸° ë•Œë¬¸','ê°€ì—´ ì†ë„ê°€ ë‹¬ëê¸° ë•Œë¬¸','ìƒ‰ê¹”ì´ ë‹¤ë¥´ê¸° ë•Œë¬¸'],
    ans:1, fbs:['âŒ ì–‘ì€ ë¬¼ì§ˆì˜ ê³ ìœ í•œ íŠ¹ì„±ì´ ì•„ë‹™ë‹ˆë‹¤.','âœ… ì •ë‹µ! ë…¹ëŠ”ì ì€ ë¬¼ì§ˆì˜ ì¢…ë¥˜ì— ë”°ë¥¸ íŠ¹ì„±ìœ¼ë¡œ, ê° ë¬¼ì§ˆë§ˆë‹¤ ê³ ìœ í•œ ê°’ì„ ê°€ì§‘ë‹ˆë‹¤.','âŒ ê°€ì—´ ì†ë„ëŠ” ë…¹ëŠ”ì ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŠµë‹ˆë‹¤.','âŒ ìƒ‰ê¹”ë„ êµ¬ë³„ ê¸°ì¤€ì´ ë  ìˆ˜ ìˆì§€ë§Œ, ë…¹ëŠ”ì ìœ¼ë¡œ êµ¬ë³„í•˜ëŠ” ì´ìœ ë¥¼ ë¬»ëŠ” ë¬¸ì œì…ë‹ˆë‹¤.'] },
  { q:'ê° ê·¸ë˜í”„ì—ì„œ 1g(ì‹¤ì„ )ê³¼ 2g(ì ì„ )ì„ ë¹„êµí•  ë•Œ ë‹¤ë¥¸ ì ì€?',
    opts:['ë…¹ëŠ”ì (ì˜¨ë„)','ë…¹ëŠ” êµ¬ê°„ì˜ ì‹œê°„(ê¸¸ì´)','ë‘˜ ë‹¤ ê°™ë‹¤','ê³¡ì„ ì˜ ëª¨ì–‘ ì „ì²´'],
    ans:1, fbs:['âŒ ë…¹ëŠ”ì (ì˜¨ë„)ì€ ì§ˆëŸ‰ê³¼ ê´€ê³„ì—†ì´ ë™ì¼í•©ë‹ˆë‹¤.','âœ… ì •ë‹µ! 2gì€ 1gë³´ë‹¤ ë…¹ëŠ” ë° ì‹œê°„ì´ ë” ê±¸ë¦¬ë¯€ë¡œ ê·¸ë˜í”„ì˜ ìˆ˜í‰ êµ¬ê°„ì´ ë” ê¹ë‹ˆë‹¤.','âŒ ë…¹ëŠ” ì‹œê°„ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤.','âŒ ê¸°ë³¸ ê³¡ì„  ëª¨ì–‘ì€ ê°™ê³ , í‰íƒ„ êµ¬ê°„ì˜ ê¸¸ì´ë§Œ ë‹¤ë¦…ë‹ˆë‹¤.'] },
  { q:'ê°€ì—´ ê³¡ì„ ì—ì„œ ë…¹ëŠ”ì ì„ ì°¾ëŠ” ë°©ë²•ì€?',
    opts:['ì˜¨ë„ê°€ ê°€ì¥ ë†’ì€ ì§€ì ','ì˜¨ë„ê°€ ì¼ì •í•˜ê²Œ ìœ ì§€ë˜ëŠ” êµ¬ê°„ì˜ ì˜¨ë„','ì˜¨ë„ê°€ ê°€ì¥ ë¹ ë¥´ê²Œ ì˜¤ë¥´ëŠ” êµ¬ê°„','ê°€ì—´ ì‹œì‘ì ì˜ ì˜¨ë„'],
    ans:1, fbs:['âŒ ê°€ì¥ ë†’ì€ ì˜¨ë„ê°€ ë…¹ëŠ”ì ì€ ì•„ë‹™ë‹ˆë‹¤.','âœ… ì •ë‹µ! ìˆœë¬¼ì§ˆì´ ë…¹ëŠ” ë™ì•ˆì—ëŠ” ì˜¨ë„ê°€ ì¼ì •í•˜ê²Œ ìœ ì§€ë©ë‹ˆë‹¤. ì´ í‰íƒ„í•œ êµ¬ê°„ì˜ ì˜¨ë„ê°€ ë…¹ëŠ”ì ì…ë‹ˆë‹¤.','âŒ ê·¸ êµ¬ê°„ì€ ê³ ì²´/ì•¡ì²´ ìƒíƒœì…ë‹ˆë‹¤.','âŒ ì‹œì‘ì ì€ ë¬¼ì§ˆì˜ ì´ˆê¸° ì˜¨ë„ì…ë‹ˆë‹¤.'] },
  { q:'ê·¸ë˜í”„ì—ì„œ ì§ì ‘ ì ì„ ì°ì–´ë³´ì•˜ì„ ë•Œ, ë¡œë¥´ì‚°ì˜ ì˜¨ë„ê°€ ì¼ì •í•˜ê²Œ ìœ ì§€ë˜ëŠ” êµ¬ê°„ì˜ ì˜¨ë„ëŠ”?',
    opts:['25Â°C','44Â°C','63Â°C','80Â°C'],
    ans:1, fbs:['âŒ 25Â°CëŠ” ì‹¤í—˜ ì‹œì‘ ì˜¨ë„(ìƒì˜¨)ì…ë‹ˆë‹¤.','âœ… ì •ë‹µ! ë¡œë¥´ì‚°ì˜ ë…¹ëŠ”ì ì€ 44Â°Cë¡œ, ê°€ì—´ ê³¡ì„ ì—ì„œ ì˜¨ë„ê°€ 44Â°Cë¡œ ì¼ì •í•˜ê²Œ ìœ ì§€ë˜ëŠ” êµ¬ê°„ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.','âŒ 63Â°CëŠ” íŒ”ë¯¸íŠ¸ì‚°ì˜ ë…¹ëŠ”ì ì…ë‹ˆë‹¤.','âŒ 80Â°CëŠ” ì‹¤í—˜ ìµœëŒ€ ì˜¨ë„ì…ë‹ˆë‹¤.'] }
];

function showQuiz() {
  document.getElementById('quizPanel').classList.add('on');
  document.getElementById('quizBox').innerHTML = QS.map((q,qi) => `
    <div class="q-item">
      <div class="q-text">Q${qi+1}. ${q.q}</div>
      <div class="q-opts">${q.opts.map((o,oi)=>`
        <button class="q-opt" onclick="doAns(${qi},${oi},this)">${'â‘ â‘¡â‘¢â‘£'[oi]} ${o}</button>
      `).join('')}</div>
      <div class="q-fb" id="qfb${qi}"></div>
    </div>
  `).join('');
}

function doAns(qi, oi, btn) {
  const q = QS[qi];
  btn.closest('.q-item').querySelectorAll('.q-opt').forEach(b => b.disabled = true);
  btn.classList.add(oi === q.ans ? 'correct' : 'wrong');
  if (oi !== q.ans) btn.closest('.q-item').querySelectorAll('.q-opt')[q.ans].classList.add('correct');
  const fb = document.getElementById('qfb'+qi);
  fb.textContent = q.fbs[oi];
  fb.className = 'q-fb on ' + (oi === q.ans ? 'ok' : 'no');
}
</script>
</body>
</html>

